-- sql is generated by devinggo
-- @Link  https://github.com/huagelong/devinggo
-- @Copyright  Copyright (c) 2024 devinggo
-- @Author  Kai <hpuwang@gmail.com>
-- @License  https://github.com/huagelong/devinggo/blob/master/LICENSE

-- PostgreSQL compatible SQL template
DO $$
DECLARE
    menu_id INTEGER;
    menu_level TEXT;
BEGIN
    -- Insert main menu and get the ID
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES ({%.table.BelongMenuId%}, '{%.menu.Level%}', '{%.table.MenuName%}', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}', 'icon-home', '{% .table.ModuleName %}_{% .tableCaseCamelLowerName %}', '{% .table.ModuleName %}/{% .tableCaseCamelLowerName %}/index', NULL, '2', 'M', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL)
    RETURNING "id" INTO menu_id;
    
    -- Set level for sub-menus
    menu_level := '{%.menu.Level%}' || menu_id || ',';
    
    -- Insert list menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '列表', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':index', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);

{% if contains .generateMenus "recycle"  %}
    -- Insert recycle related menus
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '回收站', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':recycle', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
    
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '恢复', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':recovery', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
    
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '真实删除', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':realDelete', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}

{% if contains .generateMenus "read"  %}
    -- Insert read menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '读取', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':read', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
    
{% if eq .table.Type "tree"  %}
    -- Insert tree menu for tree type tables
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '树形', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':tree', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}
{%end%}

{% if contains .generateMenus "save"  %}
    -- Insert save menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '保存', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':save', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}

{% if contains .generateMenus "update"  %}
    -- Insert update menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '更新', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':update', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
    
    -- Insert change status menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '状态变更', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':changeStatus', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}

{% if contains .generateMenus "delete"  %}
    -- Insert delete menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '删除', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':delete', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}

{% if contains .generateMenus "export"  %}
    -- Insert export menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '导出', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':export', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}

{% if contains .generateMenus "import"  %}
    -- Insert import menu
    INSERT INTO "{%.menuTableName%}"("parent_id", "level", "name", "code", "icon", "route", "component", "redirect", "is_hidden", "type", "status", "sort", "created_by", "updated_by", "created_at", "updated_at", "deleted_at", "remark") 
    VALUES (menu_id, menu_level, '{%.table.MenuName%}' || '导入', '{% .table.ModuleName %}:{% .tableCaseCamelLowerName %}' || ':import', NULL, NULL, NULL, NULL, '2', 'B', '1', 0, {%.adminId%}, NULL, NOW(), NOW(), NULL, NULL);
{%end%}

END $$;
